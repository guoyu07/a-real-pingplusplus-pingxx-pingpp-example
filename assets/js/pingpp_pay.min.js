!function(){function e(e,i,a){var t=document.createElement("form");t.setAttribute("method",i),t.setAttribute("action",e);for(var r in a)if(n.call(a,r)){var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name",r),l.setAttribute("value",a[r]),t.appendChild(l)}document.body.appendChild(t),t.submit()}function i(e){var i=[];for(var a in e)"url"!=a&&i.push(a+"="+e[a]);return i.join("&")}var a="2.0.2",n={}.hasOwnProperty,t=function(){},r={PINGPP_NOTIFY_URL:"https://api.pingxx.com/notify/charges/",UPACP_WAP_URL:"https://gateway.95516.com/gateway/api/frontTransReq.do",ALIPAY_WAP_URL:"http://wappaygw.alipay.com/service/rest.htm?_input_charset=utf-8",UPMP_WAP_URL:"uppay://uppayservice/?style=token&paydata=",BFB_SUCCESS:'<html><head><meta name="VIP_BFB_PAYMENT" content="BAIFUBAO"></head><body></body></html>',PINGPP_MOCK_URL:"http://sissi.pingxx.com/mock.php"},l={alipay_wap:"alipay_wap",upmp_wap:"upmp_wap",upacp_wap:"upacp_wap",bfb_wap:"bfb_wap",wx_pub:"wx_pub"};t.prototype={version:a,_resultCallback:void 0,_jsApiParameters:{},createPayment:function(a,t){"function"==typeof t&&(this._resultCallback=t);var o;if("string"==typeof a)try{o=JSON.parse(a)}catch(_){return void this._innerCallback("fail",this._error("json_decode_fail"))}else o=a;if("undefined"==typeof o)return void this._innerCallback("fail",this._error("json_decode_fail"));if(!n.call(o,"id"))return void this._innerCallback("fail",this._error("invalid_charge","no_charge_id"));if(!n.call(o,"channel"))return void this._innerCallback("fail",this._error("invalid_charge","no_channel"));var c=o.channel;if(!n.call(o,"credential"))return void this._innerCallback("fail",this._error("invalid_charge","no_credential"));if(!o.credential)return void this._innerCallback("fail",this._error("invalid_credential","credential_is_undefined"));if(!n.call(l,c))return void this._innerCallback("fail",this._error("invalid_charge","no_such_channel:"+c));if(!n.call(o.credential,c))return void this._innerCallback("fail",this._error("invalid_credential","no_valid_channel_credential"));if(!n.call(o,"livemode"))return void this._innerCallback("fail",this._error("invalid_charge","no_livemode"));if(0==o.livemode)return void this._testModeNotify(o);var s=o.credential[c];if(c==l.upmp_wap)location.href=r.UPMP_WAP_URL+s.paydata;else if(c==l.upacp_wap)e(r.UPACP_WAP_URL,"post",s);else if(c==l.alipay_wap)s._input_charset="utf-8",e(r.ALIPAY_WAP_URL,"get",s);else if(c==l.bfb_wap){if(!n.call(s,"url"))return void this._innerCallback("fail",this._error("invalid_credential","missing_field:url"));location.href=s.url+"?"+i(s)}else if(c==l.wx_pub){var d=["appId","timeStamp","nonceStr","package","signType","paySign"];for(var p in d)if(!n.call(s,d[p]))return void this._innerCallback("fail",this._error("invalid_credential","missing_field_"+d[p]));this._jsApiParameters=s,this._callpay()}},_jsApiCall:function(){var e=this;e._jsApiParameters!={}&&WeixinJSBridge.invoke("getBrandWCPayRequest",e._jsApiParameters,function(i){"get_brand_wcpay_request:ok"==i.err_msg?e._innerCallback("success"):"get_brand_wcpay_request:cancel"==i.err_msg?e._innerCallback("cancel"):e._innerCallback("fail",e._error("wx_result_fail",i.err_msg))})},_callpay:function(){function e(){i._jsApiCall()}var i=this;"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",e,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",e),document.attachEvent("onWeixinJSBridgeReady",e)):this._jsApiCall()},_error:function(e,i){return e="undefined"==typeof e?"":e,i="undefined"==typeof i?"":i,{msg:e,extra:i}},_innerCallback:function(e,i){"function"==typeof this._resultCallback&&("undefined"==typeof i&&(i=this._error()),this._resultCallback(e,i))},_testModeNotify:function(e){var a=this;if(e.channel==l.wx_pub){var t=confirm("模拟付款？");if(t){var o=new XMLHttpRequest;o.open("GET",r.PINGPP_NOTIFY_URL+e.id+"?livemode=false",!0),o.onload=function(){if(o.status>=200&&o.status<400&&"success"==o.responseText)a._innerCallback("success");else{var e="http_code:"+o.status+";response:"+o.responseText;a._innerCallback("fail",a._error("testmode_notify_fail",e))}},o.onerror=function(){a._innerCallback("fail",a._error("network_err"))},o.send()}else a._innerCallback("cancel")}else{var _={ch_id:e.id,scheme:"http",channel:e.channel};n.call(e,"order_no")&&(_.order_no=e.order_no),n.call(e,"extra")&&(_.extra=encodeURIComponent(JSON.stringify(e.extra))),location.href=r.PINGPP_MOCK_URL+"?"+i(_)}}},t.prototype.payment=t.prototype.createPayment,window.pingpp=new t,window.PINGPP_PAY_SDK=window.PINGPP_WX_PUB=window.pingpp}();